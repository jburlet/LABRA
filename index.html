<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>RIMA LAB | Entrenamiento Completo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --black: #000000;
            --black-light: #111111;
            --black-lighter: #1a1a1a;
            --beats-red: #e21836;
            --beats-red-dark: #b01229;
            --white: #ffffff;
            --gray: #808080;
            --gray-light: #b3b3b3;
            --gray-dark: #404040;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--black);
            color: var(--white);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            padding-bottom: 70px;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(226, 24, 54, 0.06) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 100%;
            padding: 0.75rem;
            position: relative;
            z-index: 1;
        }
        
        /* Header Compact */
        header {
            padding: 1rem 0;
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        
        .logo-circle {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: var(--beats-red);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.1rem;
            box-shadow: 0 4px 16px rgba(226, 24, 54, 0.4);
        }
        
        h1 {
            font-size: 1.3rem;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        
        /* Progress Header Compact */
        .progress-header {
            background: var(--black-lighter);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 0.8rem;
            margin: 0.75rem 0;
        }
        
        .progress-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.6rem;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--beats-red) 0%, #ff4466 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            font-size: 0.75rem;
            color: var(--gray-light);
            display: flex;
            justify-content: space-between;
        }
        
        /* Bottom Navigation Compact */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            justify-content: space-around;
            padding: 0.4rem 0;
            z-index: 1000;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.2rem;
            padding: 0.4rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: none;
            color: var(--gray);
        }
        
        .nav-item.active {
            color: var(--beats-red);
        }
        
        .nav-icon {
            font-size: 1.3rem;
        }
        
        .nav-label {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Tabs */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Exercise Card Compact */
        .exercise-card {
            background: var(--black-lighter);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 1rem;
            margin: 0.75rem 0;
        }
        
        .exercise-header {
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .exercise-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
        }
        
        .exercise-badge {
            display: inline-block;
            background: var(--beats-red);
            color: var(--white);
            padding: 0.3rem 0.8rem;
            border-radius: 100px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        /* Workflow Compact */
        .workflow-step {
            background: var(--black);
            border: 2px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 0.9rem;
            margin: 0.6rem 0;
            position: relative;
        }
        
        .workflow-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--gray-dark);
            border-radius: 3px 0 0 3px;
        }
        
        .workflow-step.active {
            border-color: var(--beats-red);
            background: rgba(226, 24, 54, 0.04);
        }
        
        .workflow-step.active::before {
            background: var(--beats-red);
        }
        
        .workflow-step.completed {
            opacity: 0.5;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 0.6rem;
        }
        
        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--gray-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        
        .workflow-step.active .step-number {
            background: var(--beats-red);
        }
        
        .step-title {
            font-size: 1rem;
            font-weight: 700;
        }
        
        .step-description {
            color: var(--gray-light);
            font-size: 0.8rem;
            margin-bottom: 0.8rem;
            line-height: 1.4;
        }
        
        /* Inputs Compact */
        .lyrics-input, .note-input {
            width: 100%;
            min-height: 120px;
            padding: 0.8rem;
            background: var(--black);
            border: 2px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: vertical;
        }
        
        .lyrics-input:focus, .note-input:focus {
            outline: none;
            border-color: var(--beats-red);
        }
        
        /* Beat Cards Compact */
        .beat-grid {
            display: grid;
            gap: 0.6rem;
            margin-top: 0.8rem;
        }
        
        .beat-card {
            background: var(--black);
            border: 2px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .beat-card.selected {
            border-color: var(--beats-red);
            background: rgba(226, 24, 54, 0.08);
        }
        
        .beat-name {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 0.15rem;
        }
        
        .beat-details {
            color: var(--gray);
            font-size: 0.75rem;
        }
        
        .beat-play {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.06);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .beat-card.playing .beat-play {
            background: var(--beats-red);
        }
        
        /* Recorder Compact */
        .recorder-container {
            background: var(--black);
            border: 2px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 1.2rem 0.8rem;
            text-align: center;
            margin-top: 0.8rem;
        }
        
        .record-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--beats-red);
            border: 3px solid var(--black);
            box-shadow: 0 0 0 3px rgba(226, 24, 54, 0.2), 0 8px 30px rgba(226, 24, 54, 0.4);
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .record-button.recording {
            animation: pulse-mobile 2s infinite;
        }
        
        @keyframes pulse-mobile {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.04); }
        }
        
        .record-icon {
            width: 26px;
            height: 26px;
            background: var(--white);
            border-radius: 50%;
        }
        
        .record-button.recording .record-icon {
            border-radius: 5px;
            width: 20px;
            height: 20px;
        }
        
        .record-status {
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        
        .record-status.recording {
            color: var(--beats-red);
        }
        
        .record-timer {
            font-size: 2rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }
        
        /* Buttons Compact */
        .btn {
            width: 100%;
            padding: 0.85rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            border-radius: 10px;
            border: none;
            margin-top: 0.8rem;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: var(--beats-red);
            color: var(--white);
            box-shadow: 0 3px 15px rgba(226, 24, 54, 0.3);
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: var(--white);
        }
        
        /* Playback Compact */
        .playback-card {
            background: rgba(226, 24, 54, 0.08);
            border: 2px solid rgba(226, 24, 54, 0.2);
            border-radius: 12px;
            padding: 0.8rem;
            margin-top: 0.8rem;
            display: none;
            align-items: center;
            gap: 0.8rem;
        }
        
        .playback-card.show {
            display: flex;
        }
        
        .play-button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--beats-red);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .playback-info {
            flex-grow: 1;
        }
        
        .playback-title {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 0.15rem;
        }
        
        .playback-details {
            color: var(--gray);
            font-size: 0.75rem;
        }
        
        /* Success Compact */
        .success-card {
            background: rgba(226, 24, 54, 0.1);
            border: 2px solid var(--beats-red);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
            margin: 1rem 0;
            display: none;
        }
        
        .success-card.show {
            display: block;
        }
        
        .success-icon {
            font-size: 2.5rem;
            margin-bottom: 0.6rem;
        }
        
        .success-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
        }
        
        .success-message {
            color: var(--gray-light);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        /* Tip Box Compact */
        .tip-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 0.8rem;
            margin: 0.8rem 0;
            font-size: 0.8rem;
            color: var(--gray-light);
            line-height: 1.4;
        }
        
        .tip-box::before {
            content: 'üí° ';
        }
        
        /* Instruction Box Compact */
        .instruction-box {
            background: rgba(226, 24, 54, 0.08);
            border: 1px solid rgba(226, 24, 54, 0.15);
            border-radius: 10px;
            padding: 0.8rem;
            margin: 0.6rem 0;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .instruction-box strong {
            color: var(--beats-red);
        }
        
        /* Notebook Compact */
        .notebook-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }
        
        .notebook-title {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .quick-note-card {
            background: var(--black-lighter);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .quick-note-card h3 {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--beats-red);
        }
        
        .saved-notes h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--gray-light);
        }
        
        .note-item {
            background: var(--black);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 0.8rem;
            margin-bottom: 0.6rem;
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
        }
        
        .note-date {
            color: var(--gray);
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 0.2rem;
        }
        
        .note-content {
            color: var(--white);
            line-height: 1.5;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--gray);
        }
        
        .empty-state-icon {
            font-size: 2.5rem;
            margin-bottom: 0.8rem;
            opacity: 0.5;
        }
        
        /* Stats Grid Compact */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin: 0.8rem 0;
        }
        
        .stat-card {
            background: var(--black-lighter);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 0.8rem;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--white);
            line-height: 1;
            margin-bottom: 0.3rem;
        }
        
        .stat-label {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Navigation Controls */
        .nav-controls {
            display: flex;
            gap: 0.6rem;
            margin-top: 1rem;
        }
        
        .nav-controls .btn {
            flex: 1;
        }
        
        /* Tablet+ */
        @media (min-width: 768px) {
            .container {
                max-width: 700px;
                margin: 0 auto;
                padding: 1.5rem;
            }
            
            .bottom-nav {
                max-width: 700px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: 16px 16px 0 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-circle">R</div>
                <div>
                    <h1>RIMA LAB</h1>
                    <div class="subtitle">ENTRENAMIENTO PRO</div>
                </div>
            </div>
        </header>
        
        <!-- TAB: ENTRENAR -->
        <div id="entrenar" class="tab-content active">
            <!-- Progress Bar -->
            <div class="progress-header">
                <div class="progress-title">üé§ GU√çA MAESTRA DE ENTRENAMIENTO FON√âTICO</div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBarFill"></div>
                </div>
                <div class="progress-text">
                    <span id="progressInfo">Fase 1 - Ejercicio 1/5</span>
                    <span id="progressPercent">4%</span>
                </div>
            </div>
            
            <!-- Current Exercise Container -->
            <div id="exerciseContainer">
                <!-- Exercises loaded dynamically -->
            </div>
            
            <!-- Navigation Controls -->
            <div class="nav-controls">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousExercise()" style="display:none;">
                    ‚Üê Anterior
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextExercise()" style="display:none;">
                    Siguiente ‚Üí
                </button>
            </div>
        </div>
        
        <!-- TAB: LIBRETA -->
        <div id="libreta" class="tab-content">
            <div class="notebook-header">
                <div class="notebook-title">üìù Libreta</div>
            </div>
            
            <div class="quick-note-card">
                <h3>Nota R√°pida</h3>
                <textarea 
                    class="note-input" 
                    id="noteInput" 
                    placeholder="Rimas, ideas, barras..."></textarea>
                <button class="btn btn-primary" onclick="saveNote()">
                    üíæ Guardar Nota
                </button>
            </div>
            
            <div class="saved-notes">
                <h3>Tus Notas</h3>
                <div id="notesList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <p>Sin notas guardadas</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB: BEATS -->
        <div id="beats" class="tab-content">
            <div class="notebook-header">
                <div class="notebook-title">üéµ Beats</div>
            </div>
            <div class="beat-grid" id="beatGridFull"></div>
        </div>
        
        <!-- TAB: PROGRESO -->
        <div id="progreso" class="tab-content">
            <div class="notebook-header">
                <div class="notebook-title">üìä Progreso</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalExercises">0/25</div>
                    <div class="stat-label">Ejercicios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRecordings">0</div>
                    <div class="stat-label">Grabaciones</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalNotes">0</div>
                    <div class="stat-label">Notas</div>
                </div>
            </div>
            
            <div class="exercise-card">
                <h3 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.8rem;">Fases Completadas</h3>
                <div id="phasesList"></div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('entrenar')">
            <div class="nav-icon">üé§</div>
            <div class="nav-label">Entrenar</div>
        </button>
        <button class="nav-item" onclick="switchTab('libreta')">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">Libreta</div>
        </button>
        <button class="nav-item" onclick="switchTab('beats')">
            <div class="nav-icon">üéµ</div>
            <div class="nav-label">Beats</div>
        </button>
        <button class="nav-item" onclick="switchTab('progreso')">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">Stats</div>
        </button>
    </div>
    
    <script>
        // EXERCISES DATABASE - 25 EXERCISES ACROSS 7 PHASES
        const EXERCISES = [
            // FASE 1: VOCALES (5 ejercicios)
            {
                phase: 1, id: 1, title: 'Primera Barra en A',
                instruction: 'Escrib√≠ 4 barras donde TODAS terminen en vocal A. Despu√©s grabar y escuchar tu flow.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 l√≠neas que terminen en A', type: 'lyrics', placeholder: 'En la calle camino con mi raza\nCada d√≠a mejoro sin que pasa...' },
                    { title: 'Eleg√≠ Beat', desc: 'Seleccion√° y escuch√°', type: 'beats' },
                    { title: 'Grabate', desc: 'Click en el bot√≥n rojo', type: 'record' },
                    { title: 'Escuch√°', desc: 'Reproduc√≠ tu grabaci√≥n', type: 'playback' }
                ]
            },
            {
                phase: 1, id: 2, title: 'Familia de Vocales',
                instruction: 'Cre√° tu banco de palabras. 5 palabras por cada vocal (A, E, I, O, U).',
                hasRecording: false,
                steps: [
                    { title: 'List√° Palabras', desc: 'Escrib√≠ 5 palabras por vocal', type: 'text' }
                ]
            },
            {
                phase: 1, id: 3, title: 'Challenge Vocal',
                instruction: '4 barras en A, despu√©s 4 barras en E. Sent√≠ la diferencia de color.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 en A + 4 en E', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 1, id: 4, title: 'Mezcl√° Vocales',
                instruction: '8 barras mezclando diferentes vocales finales. Puede ser AABB, ABAB o libre.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '8 barras mixtas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 1, id: 5, title: 'Pr√°ctica Libre - Vocales',
                instruction: 'Escrib√≠ y grab√° 8 barras libres aplicando todo lo aprendido sobre vocales.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '8 barras libres', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            
            // FASE 2: ACENTOS (4 ejercicios)
            {
                phase: 2, id: 6, title: 'Identifica Acentos',
                instruction: 'Clasific√° palabras como AGUDA, GRAVE o ESDR√öJULA para entrenar tu o√≠do.',
                hasRecording: false,
                steps: [
                    { title: 'Pr√°ctica', desc: 'Clasific√° las palabras', type: 'text' }
                ]
            },
            {
                phase: 2, id: 7, title: 'Barras Agudas',
                instruction: '4 barras donde TODAS las √∫ltimas palabras sean agudas. Dan punch al final.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras agudas', type: 'lyrics', placeholder: 'Yo voy a ganar porque s√© rapear\nEn cada batalla me van a escuchar...' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 2, id: 8, title: 'Barras Graves',
                instruction: '4 barras con palabras graves al final. Flow m√°s fluido y natural.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras graves', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 2, id: 9, title: 'Contraste de Acentos',
                instruction: '8 barras alternando: aguda, grave, aguda, grave. Sent√≠ la diferencia en tu flow.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '8 barras alternadas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            
            // FASE 3: S√çLABAS (3 ejercicios)
            {
                phase: 3, id: 10, title: 'Cuenta S√≠labas',
                instruction: 'Practic√° contar s√≠labas en diferentes palabras para controlar la m√©trica.',
                hasRecording: false,
                steps: [
                    { title: 'Pr√°ctica', desc: 'Cont√° s√≠labas', type: 'text' }
                ]
            },
            {
                phase: 3, id: 11, title: 'M√©trica de 8 S√≠labas',
                instruction: '4 barras de exactamente 8 s√≠labas cada una. M√©trica constante = flow profesional.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras de 8 s√≠labas', type: 'lyrics', placeholder: 'Yo-ca-mi-no-en-la-ca-lle (8)\nCon-mi-flow-y-mi-es-ti-lo (8)...' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 3, id: 12, title: 'Var√≠a la M√©trica',
                instruction: '4 barras variando: 8 s√≠labas, 10 s√≠labas, 8 s√≠labas, 10 s√≠labas. Crea dinamismo.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras variadas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            
            // FASE 4: RIMAS (4 ejercicios)
            {
                phase: 4, id: 13, title: 'Banco de Rimas',
                instruction: 'Escrib√≠ 10 palabras que rimen con CORAZ√ìN. Desarroll√° tu diccionario mental.',
                hasRecording: false,
                steps: [
                    { title: 'List√°', desc: '10 palabras que rimen', type: 'text' }
                ]
            },
            {
                phase: 4, id: 14, title: 'Rima Consonante AABB',
                instruction: '4 barras con esquema AABB: las primeras 2 riman, las otras 2 riman.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras AABB', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 4, id: 15, title: 'Rima Cruzada ABAB',
                instruction: '4 barras con esquema ABAB: 1 rima con 3, y 2 rima con 4. M√°s t√©cnico.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras ABAB', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 4, id: 16, title: 'Rimas Internas',
                instruction: '4 barras con al menos 1 rima interna por l√≠nea. Nivel avanzado.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '4 barras con internas', type: 'lyrics', placeholder: 'Mi MENTE est√° PRESENTE, tu GENTE solo MIENTE...' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            
            // FASE 5: FLOW (3 ejercicios)
            {
                phase: 5, id: 17, title: 'Flow Recto',
                instruction: '8 barras con flow constante y marcado. Sin cambios de velocidad.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '8 barras rectas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 5, id: 18, title: 'Flow Sincopado',
                instruction: '8 barras con cortes, pausas y cambios de ritmo. M√°s din√°mico.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '8 barras sincopadas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 5, id: 19, title: 'Doble Tiempo',
                instruction: '8 barras donde al menos 4 las rape√°s al doble de velocidad. Pr√°ctica de velocidad.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '8 barras con doble', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            
            // FASE 6: BARRAS COMPLETAS (3 ejercicios)
            {
                phase: 6, id: 20, title: 'Estructura Completa',
                instruction: '16 barras con estructura: Intro (4) + Desarrollo (8) + Cierre (4).',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '16 barras estructuradas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 6, id: 21, title: 'Barras Conceptuales',
                instruction: '16 barras sobre UN tema espec√≠fico. Manten√© el concepto toda la vuelta.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '16 barras conceptuales', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 6, id: 22, title: 'Storytelling',
                instruction: '16 barras contando una historia completa con inicio, desarrollo y final.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '16 barras narrativas', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            
            // FASE 7: ESTILO PROPIO (3 ejercicios)
            {
                phase: 7, id: 23, title: 'Define tu Estilo',
                instruction: '16 barras aplicando TODO lo aprendido. Cre√° tu firma personal.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '16 barras estilo propio', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 7, id: 24, title: 'Freestyle Challenge',
                instruction: '2 minutos de freestyle. No escribas nada antes. Solo improvis√° y grab√°.',
                hasRecording: true,
                steps: [
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Freestyle 2min', desc: 'Improvis√° directo', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            },
            {
                phase: 7, id: 25, title: 'Proyecto Final',
                instruction: '32 barras completas. Tu mejor trabajo. Aplic√° TODO lo que aprendiste.',
                hasRecording: true,
                steps: [
                    { title: 'Escrib√≠', desc: '32 barras finales', type: 'lyrics' },
                    { title: 'Eleg√≠ Beat', type: 'beats' },
                    { title: 'Grabate', type: 'record' },
                    { title: 'Escuch√°', type: 'playback' }
                ]
            }
        ];
        
        const beats = [
            { id: 1, name: 'Boom Bap 90', bpm: 90, style: 'Classic' },
            { id: 2, name: 'Trap 140', bpm: 140, style: 'Modern' },
            { id: 3, name: 'Lo-Fi 85', bpm: 85, style: 'Chill' },
            { id: 4, name: 'Drill 145', bpm: 145, style: 'Hard' }
        ];
        
        // STATE
        let state = {
            currentExerciseIndex: 0,
            currentStep: 1,
            selectedBeat: null,
            beatAudio: null,
            isRecording: false,
            mediaRecorder: null,
            audioChunks: [],
            currentRecording: null,
            recordStartTime: null,
            timerInterval: null,
            completedExercises: [],
            notes: [],
            recordings: []
        };
        
        // LOAD/SAVE
        function loadState() {
            const saved = localStorage.getItem('rimaLabState');
            if (saved) {
                const data = JSON.parse(saved);
                state.currentExerciseIndex = data.currentExerciseIndex || 0;
                state.completedExercises = data.completedExercises || [];
                state.notes = data.notes || [];
                state.recordings = data.recordings || [];
            }
        }
        
        function saveState() {
            localStorage.setItem('rimaLabState', JSON.stringify({
                currentExerciseIndex: state.currentExerciseIndex,
                completedExercises: state.completedExercises,
                notes: state.notes,
                recordings: state.recordings
            }));
        }
        
        // RENDER EXERCISE
        function renderCurrentExercise() {
            const exercise = EXERCISES[state.currentExerciseIndex];
            const container = document.getElementById('exerciseContainer');
            
            const phaseInfo = `Fase ${exercise.phase} ‚Ä¢ Ej. ${(EXERCISES.filter(e => e.phase === exercise.phase).indexOf(exercise) + 1)}`;
            
            let html = `
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title">${exercise.title}</div>
                        <div class="exercise-badge">${phaseInfo}</div>
                    </div>
                    <div class="instruction-box">
                        <strong>OBJETIVO:</strong> ${exercise.instruction}
                    </div>
            `;
            
            // Render steps
            exercise.steps.forEach((step, idx) => {
                const stepNum = idx + 1;
                const isActive = stepNum === state.currentStep;
                const isCompleted = stepNum < state.currentStep;
                
                html += `
                    <div class="workflow-step ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}" id="step${stepNum}">
                        <div class="step-header">
                            <div class="step-number">${stepNum}</div>
                            <div class="step-title">${step.title}</div>
                        </div>
                `;
                
                if (step.desc) {
                    html += `<div class="step-description">${step.desc}</div>`;
                }
                
                // Render step content based on type
                if (step.type === 'lyrics' || step.type === 'text') {
                    html += `
                        <textarea 
                            class="lyrics-input" 
                            id="stepInput${stepNum}"
                            placeholder="${step.placeholder || 'Escrib√≠ ac√°...'}"
                        ></textarea>
                    `;
                }
                
                if (step.type === 'beats') {
                    html += `<div class="beat-grid" id="beatGrid${stepNum}"></div>`;
                    html += `<div class="tip-box">Principiante? Empez√° con 90 BPM</div>`;
                }
                
                if (step.type === 'record') {
                    html += `
                        <div class="recorder-container">
                            <button class="record-button" id="recordBtn" onclick="toggleRecording()">
                                <div class="record-icon"></div>
                            </button>
                            <div class="record-status" id="recordStatus">LISTO</div>
                            <div class="record-timer" id="recordTimer">00:00</div>
                        </div>
                        <div class="tip-box">No importa si no sale perfecto. Es pr√°ctica.</div>
                    `;
                }
                
                if (step.type === 'playback') {
                    html += `
                        <div class="playback-card" id="playbackCard">
                            <button class="play-button" onclick="playRecording()">‚ñ∂</button>
                            <div class="playback-info">
                                <div class="playback-title">Tu grabaci√≥n</div>
                                <div class="playback-details" id="playbackDetails">--</div>
                            </div>
                        </div>
                    `;
                }
                
                // Step navigation button
                if (isActive && stepNum < exercise.steps.length) {
                    html += `<button class="btn btn-primary" onclick="completeStep(${stepNum})">Siguiente Paso ‚Üí</button>`;
                } else if (isActive && stepNum === exercise.steps.length) {
                    html += `<button class="btn btn-primary" onclick="completeExercise()">‚úì Completar Ejercicio</button>`;
                    if (exercise.hasRecording) {
                        html += `<button class="btn btn-secondary" onclick="reRecord()">üîÑ Re-grabar</button>`;
                    }
                }
                
                html += `</div>`;
            });
            
            html += `</div>`;
            
            // Success card
            html += `
                <div class="success-card" id="successCard">
                    <div class="success-icon">üî•</div>
                    <div class="success-title">¬°Ejercicio Completado!</div>
                    <div class="success-message">
                        ${exercise.id < 25 ? 'Segu√≠ as√≠, vas por buen camino.' : '¬°Completaste TODOS los ejercicios! Sos un profesional.'}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Init beats if needed
            exercise.steps.forEach((step, idx) => {
                if (step.type === 'beats') {
                    initBeatsForStep(idx + 1);
                }
            });
            
            // Update progress
            updateProgress();
            updateNavButtons();
        }
        
        // BEATS
        function initBeatsForStep(stepNum) {
            const container = document.getElementById('beatGrid' + stepNum);
            if (!container) return;
            
            container.innerHTML = '';
            beats.forEach(beat => {
                const div = document.createElement('div');
                div.className = 'beat-card';
                div.id = 'beat-' + beat.id + '-step' + stepNum;
                div.onclick = () => selectBeat(beat.id);
                div.innerHTML = `
                    <div class="beat-info">
                        <div class="beat-name">${beat.name}</div>
                        <div class="beat-details">${beat.bpm} BPM ‚Ä¢ ${beat.style}</div>
                    </div>
                    <button class="beat-play" onclick="toggleBeat(${beat.id}, event)">‚ñ∂</button>
                `;
                container.appendChild(div);
            });
        }
        
        function initBeatsTab() {
            const container = document.getElementById('beatGridFull');
            container.innerHTML = '';
            beats.forEach(beat => {
                const div = document.createElement('div');
                div.className = 'beat-card';
                div.id = 'beat-full-' + beat.id;
                div.onclick = () => selectBeat(beat.id);
                div.innerHTML = `
                    <div class="beat-info">
                        <div class="beat-name">${beat.name}</div>
                        <div class="beat-details">${beat.bpm} BPM ‚Ä¢ ${beat.style}</div>
                    </div>
                    <button class="beat-play" onclick="toggleBeat(${beat.id}, event)">‚ñ∂</button>
                `;
                container.appendChild(div);
            });
        }
        
        function selectBeat(beatId) {
            document.querySelectorAll('.beat-card').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll(`[id*="beat-${beatId}"]`).forEach(el => el.classList.add('selected'));
            state.selectedBeat = beatId;
        }
        
        function toggleBeat(beatId, event) {
            event.stopPropagation();
            if (state.beatAudio) {
                stopBeat();
                if (state.selectedBeat === beatId) return;
            }
            selectBeat(beatId);
            playBeat(beatId);
        }
        
        function playBeat(beatId) {
            const beat = beats.find(b => b.id === beatId);
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.type = 'sine';
            oscillator.frequency.value = 60;
            
            const tempo = 60 / beat.bpm;
            let time = audioContext.currentTime;
            
            for (let i = 0; i < 32; i++) {
                gainNode.gain.setValueAtTime(0.5, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
                time += tempo;
            }
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(time);
            state.beatAudio = audioContext;
            
            document.querySelectorAll(`[id*="beat-${beatId}"]`).forEach(el => {
                el.classList.add('playing');
                const btn = el.querySelector('.beat-play');
                if (btn) btn.textContent = '‚è∏';
            });
            
            setTimeout(() => {
                stopBeat();
                if (state.selectedBeat === beatId) playBeat(beatId);
            }, tempo * 32 * 1000);
        }
        
        function stopBeat() {
            if (state.beatAudio) {
                state.beatAudio.close();
                state.beatAudio = null;
            }
            document.querySelectorAll('.beat-card').forEach(el => {
                el.classList.remove('playing');
                const btn = el.querySelector('.beat-play');
                if (btn) btn.textContent = '‚ñ∂';
            });
        }
        
        // RECORDING
        async function toggleRecording() {
            if (state.isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }
        
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                state.mediaRecorder = new MediaRecorder(stream);
                state.audioChunks = [];
                
                state.mediaRecorder.ondataavailable = (event) => {
                    state.audioChunks.push(event.data);
                };
                
                state.mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(state.audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    state.currentRecording = {
                        url: audioUrl,
                        blob: audioBlob,
                        duration: Math.floor((Date.now() - state.recordStartTime) / 1000)
                    };
                    
                    state.recordings.push({
                        exerciseId: EXERCISES[state.currentExerciseIndex].id,
                        date: new Date().toLocaleString('es-AR'),
                        duration: state.currentRecording.duration
                    });
                    
                    const playback = document.getElementById('playbackCard');
                    if (playback) {
                        playback.classList.add('show');
                        document.getElementById('playbackDetails').textContent = 
                            `Duraci√≥n: ${state.currentRecording.duration}s`;
                    }
                    
                    const currentStepEl = document.querySelector('.workflow-step.active');
                    if (currentStepEl) {
                        const stepNum = parseInt(currentStepEl.id.replace('step', ''));
                        completeStep(stepNum);
                    }
                    
                    saveState();
                    updateStats();
                };
                
                state.mediaRecorder.start();
                state.isRecording = true;
                state.recordStartTime = Date.now();
                
                const btn = document.getElementById('recordBtn');
                const status = document.getElementById('recordStatus');
                if (btn) btn.classList.add('recording');
                if (status) {
                    status.textContent = 'GRABANDO';
                    status.classList.add('recording');
                }
                
                startTimer();
                
            } catch (err) {
                alert('Necesitamos acceso al micr√≥fono');
            }
        }
        
        function stopRecording() {
            if (state.mediaRecorder && state.isRecording) {
                state.mediaRecorder.stop();
                state.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                state.isRecording = false;
                
                const btn = document.getElementById('recordBtn');
                const status = document.getElementById('recordStatus');
                if (btn) btn.classList.remove('recording');
                if (status) {
                    status.textContent = 'LISTO';
                    status.classList.remove('recording');
                }
                
                stopTimer();
            }
        }
        
        function startTimer() {
            state.timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - state.recordStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                const timer = document.getElementById('recordTimer');
                if (timer) timer.textContent = `${minutes}:${seconds}`;
            }, 1000);
        }
        
        function stopTimer() {
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
            const timer = document.getElementById('recordTimer');
            if (timer) timer.textContent = '00:00';
        }
        
        function playRecording() {
            if (state.currentRecording) {
                const audio = new Audio(state.currentRecording.url);
                audio.play();
            }
        }
        
        function reRecord() {
            // Find record step and activate it
            const exercise = EXERCISES[state.currentExerciseIndex];
            const recordStepIndex = exercise.steps.findIndex(s => s.type === 'record');
            if (recordStepIndex >= 0) {
                state.currentStep = recordStepIndex + 1;
                renderCurrentExercise();
            }
        }
        
        // NAVIGATION
        function completeStep(stepNum) {
            const exercise = EXERCISES[state.currentExerciseIndex];
            
            // Validation
            const step = exercise.steps[stepNum - 1];
            if ((step.type === 'lyrics' || step.type === 'text') && stepNum < exercise.steps.length) {
                const input = document.getElementById('stepInput' + stepNum);
                if (input && !input.value.trim()) {
                    alert('Complet√° este paso primero');
                    return;
                }
            }
            
            if (step.type === 'beats' && !state.selectedBeat) {
                alert('Eleg√≠ un beat primero');
                return;
            }
            
            state.currentStep = stepNum + 1;
            renderCurrentExercise();
            
            // Scroll to next step
            setTimeout(() => {
                const nextStep = document.getElementById('step' + state.currentStep);
                if (nextStep) {
                    nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }
        
        function completeExercise() {
            const exercise = EXERCISES[state.currentExerciseIndex];
            
            if (!state.completedExercises.includes(exercise.id)) {
                state.completedExercises.push(exercise.id);
            }
            
            saveState();
            updateProgress();
            updateStats();
            
            document.getElementById('successCard').classList.add('show');
            document.getElementById('successCard').scrollIntoView({ behavior: 'smooth' });
            
            updateNavButtons();
        }
        
        function previousExercise() {
            if (state.currentExerciseIndex > 0) {
                state.currentExerciseIndex--;
                state.currentStep = 1;
                state.selectedBeat = null;
                state.currentRecording = null;
                saveState();
                renderCurrentExercise();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function nextExercise() {
            if (state.currentExerciseIndex < EXERCISES.length - 1) {
                state.currentExerciseIndex++;
                state.currentStep = 1;
                state.selectedBeat = null;
                state.currentRecording = null;
                saveState();
                renderCurrentExercise();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function updateNavButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (prevBtn) {
                prevBtn.style.display = state.currentExerciseIndex > 0 ? 'block' : 'none';
            }
            
            if (nextBtn) {
                const isCompleted = state.completedExercises.includes(EXERCISES[state.currentExerciseIndex].id);
                nextBtn.style.display = (isCompleted && state.currentExerciseIndex < EXERCISES.length - 1) ? 'block' : 'none';
            }
        }
        
        // PROGRESS
        function updateProgress() {
            const totalExercises = EXERCISES.length;
            const completed = state.completedExercises.length;
            const percentage = Math.round((completed / totalExercises) * 100);
            
            document.getElementById('progressBarFill').style.width = percentage + '%';
            document.getElementById('progressPercent').textContent = percentage + '%';
            
            const current = EXERCISES[state.currentExerciseIndex];
            const phaseExercises = EXERCISES.filter(e => e.phase === current.phase);
            const currentInPhase = phaseExercises.indexOf(current) + 1;
            
            document.getElementById('progressInfo').textContent = 
                `Fase ${current.phase} - Ejercicio ${currentInPhase}/${phaseExercises.length}`;
        }
        
        function updateStats() {
            document.getElementById('totalExercises').textContent = 
                `${state.completedExercises.length}/25`;
            document.getElementById('totalRecordings').textContent = state.recordings.length;
            document.getElementById('totalNotes').textContent = state.notes.length;
            
            // Update phases list
            const phasesContainer = document.getElementById('phasesList');
            if (phasesContainer) {
                let html = '';
                for (let phase = 1; phase <= 7; phase++) {
                    const phaseExercises = EXERCISES.filter(e => e.phase === phase);
                    const completed = phaseExercises.filter(e => 
                        state.completedExercises.includes(e.id)
                    ).length;
                    const total = phaseExercises.length;
                    const percent = Math.round((completed / total) * 100);
                    
                    html += `
                        <div style="margin-bottom: 0.8rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem;">
                                <span style="font-size: 0.85rem; font-weight: 600;">Fase ${phase}</span>
                                <span style="font-size: 0.75rem; color: var(--gray);">${completed}/${total}</span>
                            </div>
                            <div style="width: 100%; height: 4px; background: rgba(255,255,255,0.06); border-radius: 2px; overflow: hidden;">
                                <div style="height: 100%; background: var(--beats-red); width: ${percent}%;"></div>
                            </div>
                        </div>
                    `;
                }
                phasesContainer.innerHTML = html;
            }
        }
        
        // NOTEBOOK
        function saveNote() {
            const content = document.getElementById('noteInput').value.trim();
            if (!content) {
                alert('Escrib√≠ algo primero');
                return;
            }
            
            const note = {
                id: Date.now(),
                content: content,
                date: new Date().toLocaleString('es-AR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };
            
            state.notes.unshift(note);
            saveState();
            renderNotes();
            updateStats();
            
            document.getElementById('noteInput').value = '';
            alert('Nota guardada! üíæ');
        }
        
        function renderNotes() {
            const container = document.getElementById('notesList');
            
            if (state.notes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <p>Sin notas guardadas</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.notes.map(note => `
                <div class="note-item">
                    <div class="note-header">
                        <div class="note-date">${note.date}</div>
                        <button class="icon-btn" onclick="deleteNote(${note.id})">üóëÔ∏è</button>
                    </div>
                    <div class="note-content">${note.content}</div>
                </div>
            `).join('');
        }
        
        function deleteNote(id) {
            if (confirm('¬øBorrar esta nota?')) {
                state.notes = state.notes.filter(n => n.id !== id);
                saveState();
                renderNotes();
                updateStats();
            }
        }
        
        // TABS
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
        }
        
        // INIT
        window.addEventListener('load', () => {
            loadState();
            renderCurrentExercise();
            renderNotes();
            initBeatsTab();
            updateStats();
        });
    </script>
</body>
</html>
</body>
</html>
